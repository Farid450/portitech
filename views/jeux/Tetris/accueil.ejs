<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../../partials/head %>
    <meta charset="UTF-8">
    <title>TETRIS</title>
    <script src="../../../javascripts/Tetris/phaser.min.js"></script>
</head>

<body style="margin:0px auto;">
<header><% include ../../partials/header %></header>
HELLO WORLD
<SCRIPT LANGUAGE="JavaScript">
    function posterScore(data){
        $.ajax({
            type: "POST",
            url: '/api/score',
            data: data,
            success: function(msg){
                alert( "RÃ©sultat: " + msg );
            }
        });
    };
</SCRIPT>

<div align="center">
    <script>

        var game = new Phaser.Game(160, 320, Phaser.AUTO, 'Tetris', { preload: preload, create: create, update: update });

        console.log(grid);
        function preload() {
            game.load.spritesheet('tetrominos', '../../../images/tetris/Tetrominos.png',32,16);
            //game.load.spritesheet('bg', '../../../images/tetris/Grid.png');
            console.log('preload');
        }
        function create() {

           // this.game.time.events.loop(125, this.updateStrength, this);


            //BackgroundSprite = game.add.tileSprite(0,0,game.width,game.height,'bg')
            player = game.add.sprite(40, 0, 'tetrominos');

            game.physics.arcade.enable(player);
            //game.physics.ninja.enable(player);


            //  Player physics properties. Give the little guy a slight bounce.
            player.body.gravity.y = 50;
            player.body.collideWorldBounds = true;
            player.enableBody = true;

            //  Our two animations, walking left and right.
           // player.animations.add('left', [0, 1, 2, 3], 10, true);
           // player.animations.add('right', [5, 6, 7, 8], 10, true);
            //  Register the keys.
            this.leftKey = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
            this.rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
            this.upKey = game.input.keyboard.addKey(Phaser.Keyboard.UP);
            this.downKey = game.input.keyboard.addKey(Phaser.Keyboard.DOWN);
            //  Stop the following keys from propagating up to the browser
            game.input.keyboard.addKeyCapture([ Phaser.Keyboard.LEFT, Phaser.Keyboard.RIGHT, Phaser.Keyboard.UP,Phaser.Keyboard.DOWN ]);
            console.log('create');
        }
        var cpt = 0;
        player.angle = 0;
        function update() {


                 game.debug.body(player);
                 cpt++;
                 if (cpt == 500) {
                     player.body.y += 16;
                     cpt = 0;
                 }




                 //  Reset the players velocity (movement)
                 player.body.velocity.x = 0;

                 if (this.leftKey.isDown) {
                     //  Move to the left
                         player.body.moveLeft(16);
                     }


                 if (this.rightKey.isDown) {
                     //  Move to the right
                     player.body.moveRight(16);
                     }


                 if (this.upKey.isDown)
                     {
                         player.angle = 90;


                     }
                 if (this.downKey.isDown) {
                     player.body.y += 16;
                 }
                    console.log('update');
                 if(player.body.touching == true){
                    player.kill();
                 }
        }
    </script>
</div>

    <input type = "button" onclick="posterScore(1200)" >envoye-ton score</input>


</body>
</html>